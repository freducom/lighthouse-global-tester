<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistics - CheetahCheck</title>
    <meta name="description" content="Comprehensive statistics and analytics for CheetahCheck's global website performance monitoring across 668 websites in 69 countries.">
    
    <link rel="stylesheet" href="styles.css">
        <link rel="icon" type="image/png" sizes="16x16" href="cheetahcheck_favicon_16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="cheetahcheck_favicon_32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="cheetahcheck_favicon_48x48.png">
    <link rel="icon" type="image/png" sizes="64x64" href="cheetahcheck_favicon_64x64.png">
    <link rel="icon" type="image/png" sizes="128x128" href="cheetahcheck_favicon_128x128.png">
    <link rel="icon" type="image/png" sizes="256x256" href="cheetahcheck_favicon_256x256.png">
    <link rel="apple-touch-icon" sizes="128x128" href="cheetahcheck_favicon_128x128.png">
    <link rel="apple-touch-icon" sizes="256x256" href="cheetahcheck_favicon_256x256.png">
        <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="CheetahCheck">
    <meta name="mobile-web-app-capable" content="yes">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        
        <header class="header" role="banner">
            <div class="logo-container">
                <a href="index.html"><img src="logo.png" alt="CheetahCheck" class="header-logo"></a>
            </div>
            <p class="subtitle">Performance Statistics</p>
            <p class="back-to-frontpage"><a href="index.html">‚Üê Back to frontpage</a></p>
        </header>
    
        <main class="container">

            <!-- Global Overview Stats (Real Data) -->
            <section class="stats-grid">
                <div class="stat-tile">
                    <div class="stat-icon">üåê</div>
                    <div class="stat-content">
                        <div class="stat-number">668</div>
                        <div class="stat-label">Total Websites</div>
                    </div>
                </div>
                
                <div class="stat-tile">
                    <div class="stat-icon">üè¥Û†Åø</div>
                    <div class="stat-content">
                        <div class="stat-number">69</div>
                        <div class="stat-label">Countries</div>
                    </div>
                </div>
                
                <div class="stat-tile">
                    <div class="stat-icon">üè≠</div>
                    <div class="stat-content">
                        <div class="stat-number">38</div>
                        <div class="stat-label">Industries</div>
                    </div>
                </div>
                
                <div class="stat-tile">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-content">
                        <div class="stat-number">44</div>
                        <div class="stat-label">Avg Performance</div>
                    </div>
                </div>
            </section>

            <!-- Performance Distribution (Real Data) -->
            <section class="chart-section">
                <h2>Performance Score Distribution</h2>
                <p class="chart-description">Real distribution from 668 tested websites</p>
                <div class="performance-distribution">
                    <div class="perf-category excellent">
                        <div class="perf-number">17</div>
                        <div class="perf-label">Excellent (90+)</div>
                        <div class="perf-percentage">3%</div>
                    </div>
                    <div class="perf-category good">
                        <div class="perf-number">206</div>
                        <div class="perf-label">Good (50-89)</div>
                        <div class="perf-percentage">31%</div>
                    </div>
                    <div class="perf-category poor">
                        <div class="perf-number">445</div>
                        <div class="perf-label">Poor (0-49)</div>
                        <div class="perf-percentage">67%</div>
                    </div>
                </div>
            </section>

            <!-- Top Industries Performance (Real Data) -->
            <section class="chart-section">
                <h2>üè≠ Top Industries by Performance</h2>
                <p class="chart-description">Real industry performance averages from tested websites</p>
                <div class="chart-container">
                    <canvas id="topIndustriesChart"></canvas>
                </div>
            </section>

            <!-- Top Countries Performance (Real Data) -->
            <section class="chart-section">
                <h2>üåç Top Countries by Performance</h2>
                <p class="chart-description">Leading countries in web performance scores</p>
                <div class="chart-container">
                    <canvas id="topCountriesChart"></canvas>
                </div>
            </section>

            <!-- Industry Benchmarking (Real Data) -->
            <section class="chart-section">
                <h2>üéØ Industry Benchmarking</h2>
                <p class="chart-description">Top 5 industries by number of domains tested - showing performance across all metrics</p>
                <div class="chart-container">
                    <canvas id="industryBenchmarkChart"></canvas>
                </div>
            </section>

            <!-- Industry Performance Correlation (Real Data) -->
            <section class="chart-section">
                <h2>üìä Industry Performance Correlation</h2>
                <p class="chart-description">Correlation between industry type and performance scores - bubble size represents number of websites</p>
                <div class="chart-container">
                    <canvas id="industryCorrelationChart"></canvas>
                </div>
            </section>

            <!-- Regional Performance Analysis (Real Data) -->
            <section class="chart-section">
                <h2>üåç Regional Performance Analysis</h2>
                <p class="chart-description">Performance distribution by major regions</p>
                <div class="chart-container">
                    <canvas id="regionalAnalysisChart"></canvas>
                </div>
            </section>

        </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            
            <div class="footer-section">
                <p><button onclick="openWebsiteModal()" class="suggest-btn">Add your website</button></p>
                <p><a href="stats.html">Stats</a> |¬†<a href="about.html">About</a> | <a href="api-docs.html">API Documentation</a> |¬†<a href="latest-updated.html">Latest Scan</a> |¬†<a href="queued-sites.html">Queued Sites</a> |¬†<a href="https://flipsite.io" target="_blank">Build 100% scoring sites</a></p>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2025 CheetahCheck. Google Lighthouse performance monitoring of 668 websites.</p>
        </div>
    </footer>

        <!-- Website Suggestion Modal -->
        <div id="websiteModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üí° Suggest a Website</h2>
                    <button class="close-btn" onclick="closeWebsiteModal()" aria-label="Close suggestion form">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Help us expand our lighthouse analysis by suggesting high-quality websites to include in our monitoring.</p>
                    <form id="websiteForm" onsubmit="handleWebsiteSubmission(event)">
                        <div class="form-group">
                            <label for="websiteUrl">Website URL *</label>
                            <input type="url" id="websiteUrl" name="url" required 
                                   placeholder="https://example.com" 
                                   aria-describedby="url-help">
                            <small id="url-help">Enter the full URL including https://</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="websiteCategory">Category</label>
                            <select id="websiteCategory" name="category">
                                <option value="">Select a category (optional)</option>
                                <option value="e-commerce">E-commerce</option>
                                <option value="news-media">News & Media</option>
                                <option value="technology">Technology</option>
                                <option value="education">Education</option>
                                <option value="government">Government</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="finance">Finance</option>
                                <option value="entertainment">Entertainment</option>
                                <option value="travel">Travel</option>
                                <option value="food-beverage">Food & Beverage</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="websiteDescription">Why should we include this website?</label>
                            <textarea id="websiteDescription" name="description" rows="3" 
                                      placeholder="Brief description of why this website would be valuable for lighthouse analysis..." 
                                      maxlength="500"></textarea>
                            <small>Optional: Help us understand the value of including this website</small>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" onclick="closeWebsiteModal()" class="btn-secondary">Cancel</button>
                            <button type="submit" class="btn-primary">Submit Suggestion</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
        function openWebsiteModal() {
            const modal = document.getElementById('websiteModal');
            modal.style.display = 'block';
            modal.setAttribute('aria-hidden', 'false');
            
            // Focus the first input for accessibility
            setTimeout(() => {
                document.getElementById('websiteUrl').focus();
            }, 100);
            
            // Trap focus within modal
            modal.addEventListener('keydown', trapFocus);
        }

        function closeWebsiteModal() {
            const modal = document.getElementById('websiteModal');
            modal.style.display = 'none';
            modal.setAttribute('aria-hidden', 'true');
            modal.removeEventListener('keydown', trapFocus);
            
            // Reset form
            document.getElementById('websiteForm').reset();
        }

        function trapFocus(e) {
            if (e.key === 'Escape') {
                closeWebsiteModal();
                return;
            }
            
            if (e.key === 'Tab') {
                const modal = document.getElementById('websiteModal');
                const focusableElements = modal.querySelectorAll(
                    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                );
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];

                if (e.shiftKey) {
                    if (document.activeElement === firstElement) {
                        lastElement.focus();
                        e.preventDefault();
                    }
                } else {
                    if (document.activeElement === lastElement) {
                        firstElement.focus();
                        e.preventDefault();
                    }
                }
            }
        }

        function handleWebsiteSubmission(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const data = {
                url: formData.get('url'),
                category: formData.get('category'),
                description: formData.get('description'),
                timestamp: new Date().toISOString()
            };
            
            // Here you could send to your backend/API
            console.log('Website suggestion submitted:', data);
            
            // Show success message
            alert('Thank you for your suggestion! We\'ll review it and consider adding it to our lighthouse monitoring.');
            
            // Close modal
            closeWebsiteModal();
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('websiteModal');
            if (event.target === modal) {
                closeWebsiteModal();
            }
        }
        </script>
    </div>

    <script>
        // ALL CHARTS USE ONLY REAL DATA FROM THE DATABASE

        // Top Industries Chart (Real Data)
        const topIndustriesCtx = document.getElementById('topIndustriesChart');
        if (topIndustriesCtx) {
            new Chart(topIndustriesCtx, {
                type: 'bar',
                data: {
                    labels: ['Healthtech', 'Gaming', 'Consulting', 'Tech', 'Government', 'Jobs', 'Website editor', 'Search Engine', 'Delivery', 'Portal'],
                    datasets: [{
                        label: 'Average Performance Score',
                        data: [69.5, 68, 61.3, 57, 56.2, 55.9, 55.6, 55, 54, 51.5],
                        backgroundColor: [
                            '#22C55E', '#16A34A', '#15803D', '#FFB703', '#E07A00', '#D97706',
                            '#EF4444', '#DC2626', '#B91C1C', '#991B1B'
                        ],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Real Performance Data by Industry'
                        }
                    },
                    scales: {
                        x: { beginAtZero: true, max: 100 }
                    }
                }
            });
        }

        // Top Countries Chart (Real Data)
        const topCountriesCtx = document.getElementById('topCountriesChart');
        if (topCountriesCtx) {
            new Chart(topCountriesCtx, {
                type: 'bar',
                data: {
                    labels: ['üá≤üáæ Malaysia', 'üáßüá¥ Bolivia', 'üáÆüá∑ Iran', 'üáßüá¨ Bulgaria', 'üá≤üáΩ Mexico', 'üá≥üá± Netherlands', 'üá±üáæ Libya', 'üá∫üá¶ Ukraine', 'üáßüá™ Belgium', 'üáøüá≤ Zambia'],
                    datasets: [{
                        label: 'Average Performance Score',
                        data: [79, 78.7, 63.9, 58.7, 55.2, 54.4, 54.4, 53.9, 53.1, 51.8],
                        backgroundColor: '#22C55E',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Top 10 Countries by Performance Score'
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });
        }

        // Industry Benchmarking (Real Data - Top 5 by Domain Count)
        const industryBenchmarkCtx = document.getElementById('industryBenchmarkChart');
        if (industryBenchmarkCtx) {
            // Sort industries by site count and get top 5
            const industriesBySiteCount = [{
                industry: 'Healthtech',
                site_count: 2,
                performance: 69.5,
                accessibility: 93,
                best_practices: 96,
                seo: 96.5,
                pwa: 33
            }, {
                industry: 'Gaming',
                site_count: 1,
                performance: 68,
                accessibility: 96,
                best_practices: 100,
                seo: 100,
                pwa: 33
            }, {
                industry: 'Consulting',
                site_count: 3,
                performance: 61.3,
                accessibility: 97.3,
                best_practices: 94.7,
                seo: 88.3,
                pwa: 44.3
            }, {
                industry: 'Tech',
                site_count: 1,
                performance: 57,
                accessibility: 89,
                best_practices: 83,
                seo: 93,
                pwa: 33
            }, {
                industry: 'Government',
                site_count: 24,
                performance: 56.2,
                accessibility: 87.3,
                best_practices: 90.8,
                seo: 93.8,
                pwa: 38.6
            }, {
                industry: 'Jobs',
                site_count: 7,
                performance: 55.9,
                accessibility: 86.4,
                best_practices: 75.1,
                seo: 91,
                pwa: 50.7
            }, {
                industry: 'Website editor',
                site_count: 7,
                performance: 55.6,
                accessibility: 93.4,
                best_practices: 88.1,
                seo: 92.1,
                pwa: 37.9
            }, {
                industry: 'Search Engine',
                site_count: 5,
                performance: 55,
                accessibility: 81.8,
                best_practices: 86.8,
                seo: 83.8,
                pwa: 33
            }, {
                industry: 'Delivery',
                site_count: 2,
                performance: 54,
                accessibility: 90.5,
                best_practices: 92,
                seo: 91,
                pwa: 33
            }, {
                industry: 'Portal',
                site_count: 28,
                performance: 51.5,
                accessibility: 75.9,
                best_practices: 77.8,
                seo: 89.3,
                pwa: 47.1
            }, {
                industry: 'Social',
                site_count: 1,
                performance: 49,
                accessibility: 90,
                best_practices: 75,
                seo: 94,
                pwa: 67
            }, {
                industry: 'Education',
                site_count: 21,
                performance: 48.8,
                accessibility: 87.6,
                best_practices: 85.7,
                seo: 83.7,
                pwa: 31.4
            }, {
                industry: 'Social Media',
                site_count: 17,
                performance: 45.6,
                accessibility: 80.2,
                best_practices: 69.6,
                seo: 89.6,
                pwa: 50.8
            }, {
                industry: 'Healthcare',
                site_count: 6,
                performance: 44.5,
                accessibility: 91.8,
                best_practices: 86.2,
                seo: 92.2,
                pwa: 55.5
            }, {
                industry: 'Marketplace',
                site_count: 22,
                performance: 44.3,
                accessibility: 84,
                best_practices: 83.3,
                seo: 92.5,
                pwa: 52.5
            }, {
                industry: 'Finance',
                site_count: 75,
                performance: 43.7,
                accessibility: 89.1,
                best_practices: 80.6,
                seo: 89.2,
                pwa: 37.7
            }, {
                industry: 'Video',
                site_count: 1,
                performance: 43,
                accessibility: 91,
                best_practices: 75,
                seo: 93,
                pwa: 33
            }, {
                industry: 'E-commerce',
                site_count: 44,
                performance: 42.6,
                accessibility: 82.5,
                best_practices: 77.8,
                seo: 90,
                pwa: 45
            }, {
                industry: 'Marketing',
                site_count: 6,
                performance: 42.3,
                accessibility: 92,
                best_practices: 66.7,
                seo: 91.8,
                pwa: 33
            }, {
                industry: 'Energy',
                site_count: 1,
                performance: 42,
                accessibility: 88,
                best_practices: 58,
                seo: 72,
                pwa: 33
            }, {
                industry: 'Media',
                site_count: 304,
                performance: 41.8,
                accessibility: 85.7,
                best_practices: 79.2,
                seo: 90.9,
                pwa: 44.4
            }, {
                industry: 'Transportation',
                site_count: 13,
                performance: 41.6,
                accessibility: 86.7,
                best_practices: 84,
                seo: 90.8,
                pwa: 39.1
            }, {
                industry: 'Realestate',
                site_count: 2,
                performance: 41.5,
                accessibility: 89.5,
                best_practices: 92,
                seo: 100,
                pwa: 33
            }, {
                industry: 'Technology',
                site_count: 17,
                performance: 40.8,
                accessibility: 89.5,
                best_practices: 78.5,
                seo: 88.2,
                pwa: 35
            }, {
                industry: 'Sports',
                site_count: 8,
                performance: 40.8,
                accessibility: 79.8,
                best_practices: 79.3,
                seo: 86.6,
                pwa: 40.1
            }, {
                industry: 'Weather',
                site_count: 2,
                performance: 40.5,
                accessibility: 96,
                best_practices: 79,
                seo: 95,
                pwa: 50
            }, {
                industry: 'Manufacturing',
                site_count: 1,
                performance: 40,
                accessibility: 100,
                best_practices: 75,
                seo: 93,
                pwa: 33
            }, {
                industry: 'Non-profit',
                site_count: 2,
                performance: 39,
                accessibility: 84.5,
                best_practices: 83,
                seo: 85.5,
                pwa: 33
            }, {
                industry: 'Edtech',
                site_count: 2,
                performance: 36.5,
                accessibility: 79.5,
                best_practices: 83.5,
                seo: 93,
                pwa: 33
            }, {
                industry: 'Software',
                site_count: 3,
                performance: 36.3,
                accessibility: 88.7,
                best_practices: 80.3,
                seo: 90.7,
                pwa: 33
            }, {
                industry: 'Food & Drink',
                site_count: 1,
                performance: 35,
                accessibility: 88,
                best_practices: 75,
                seo: 82,
                pwa: 33
            }, {
                industry: 'Retail',
                site_count: 7,
                performance: 34.3,
                accessibility: 84.1,
                best_practices: 56,
                seo: 86.3,
                pwa: 36.3
            }, {
                industry: 'Telecom',
                site_count: 17,
                performance: 34.1,
                accessibility: 90,
                best_practices: 79.8,
                seo: 90.5,
                pwa: 35
            }, {
                industry: 'Hospitality',
                site_count: 1,
                performance: 34,
                accessibility: 100,
                best_practices: 83,
                seo: 99,
                pwa: 56
            }, {
                industry: 'Automotive',
                site_count: 10,
                performance: 33.7,
                accessibility: 88.3,
                best_practices: 70.7,
                seo: 92.1,
                pwa: 48.8
            }, {
                industry: 'Engineering',
                site_count: 1,
                performance: 33,
                accessibility: 65,
                best_practices: 83,
                seo: 85,
                pwa: 33
            }, {
                industry: 'Real Estate',
                site_count: 2,
                performance: 31.5,
                accessibility: 88.5,
                best_practices: 79,
                seo: 89,
                pwa: 89
            }, {
                industry: 'Travel',
                site_count: 1,
                performance: 27,
                accessibility: 79,
                best_practices: 67,
                seo: 90,
                pwa: 33
            }].sort((a, b) => b.site_count - a.site_count).slice(0, 5);
            
            const datasets = industriesBySiteCount.map((ind, index) => ({
                label: ind.industry + ' (' + ind.site_count + ' sites)',
                data: [ind.performance, ind.accessibility, ind.best_practices, ind.seo, ind.pwa],
                borderColor: ['#22C55E', '#3B82F6', '#8B5CF6', '#FFB703', '#EF4444'][index],
                backgroundColor: ['rgba(34, 197, 94, 0.2)', 'rgba(59, 130, 246, 0.2)', 'rgba(139, 92, 246, 0.2)', 'rgba(255, 183, 3, 0.2)', 'rgba(239, 68, 68, 0.2)'][index],
                pointBackgroundColor: ['#22C55E', '#3B82F6', '#8B5CF6', '#FFB703', '#EF4444'][index]
            }));
            
            // Add global average
            datasets.push({
                label: 'Global Average',
                data: [43.5, 85.9, 79.7, 90.3, 42.7],
                borderColor: '#6B7280',
                backgroundColor: 'rgba(107, 114, 128, 0.1)',
                pointBackgroundColor: '#6B7280',
                borderDash: [5, 5]
            });

            new Chart(industryBenchmarkCtx, {
                type: 'radar',
                data: {
                    labels: ['Performance', 'Accessibility', 'Best Practices', 'SEO', 'PWA'],
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Top 5 Industries by Domain Count'
                        }
                    },
                    scales: {
                        r: {
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    }
                }
            });
        }

        // Industry Performance Correlation (Real Data - Bubble Chart)
        const industryCorrelationCtx = document.getElementById('industryCorrelationChart');
        if (industryCorrelationCtx) {
            // Create bubble chart data showing correlation between industry and performance
            const industryData = [{
                label: 'Healthtech',
                x: 1, // Industry index (categorical x-axis)
                y: 69.5, // Performance score
                r: 6, // Bubble size based on number of sites
                backgroundColor: '#22C55E80'
            }, {
                label: 'Gaming',
                x: 2, // Industry index (categorical x-axis)
                y: 68, // Performance score
                r: 5, // Bubble size based on number of sites
                backgroundColor: '#16A34A80'
            }, {
                label: 'Consulting',
                x: 3, // Industry index (categorical x-axis)
                y: 61.3, // Performance score
                r: 9, // Bubble size based on number of sites
                backgroundColor: '#15803D80'
            }, {
                label: 'Tech',
                x: 4, // Industry index (categorical x-axis)
                y: 57, // Performance score
                r: 5, // Bubble size based on number of sites
                backgroundColor: '#FFB70380'
            }, {
                label: 'Government',
                x: 5, // Industry index (categorical x-axis)
                y: 56.2, // Performance score
                r: 25, // Bubble size based on number of sites
                backgroundColor: '#E07A0080'
            }, {
                label: 'Jobs',
                x: 6, // Industry index (categorical x-axis)
                y: 55.9, // Performance score
                r: 21, // Bubble size based on number of sites
                backgroundColor: '#D9770680'
            }, {
                label: 'Website editor',
                x: 7, // Industry index (categorical x-axis)
                y: 55.6, // Performance score
                r: 21, // Bubble size based on number of sites
                backgroundColor: '#EF444480'
            }, {
                label: 'Search Engine',
                x: 8, // Industry index (categorical x-axis)
                y: 55, // Performance score
                r: 15, // Bubble size based on number of sites
                backgroundColor: '#DC262680'
            }, {
                label: 'Delivery',
                x: 9, // Industry index (categorical x-axis)
                y: 54, // Performance score
                r: 6, // Bubble size based on number of sites
                backgroundColor: '#B91C1C80'
            }, {
                label: 'Portal',
                x: 10, // Industry index (categorical x-axis)
                y: 51.5, // Performance score
                r: 25, // Bubble size based on number of sites
                backgroundColor: '#991B1B80'
            }, {
                label: 'Social',
                x: 11, // Industry index (categorical x-axis)
                y: 49, // Performance score
                r: 5, // Bubble size based on number of sites
                backgroundColor: '#8B5CF680'
            }, {
                label: 'Education',
                x: 12, // Industry index (categorical x-axis)
                y: 48.8, // Performance score
                r: 25, // Bubble size based on number of sites
                backgroundColor: '#7C3AED80'
            }, {
                label: 'Social Media',
                x: 13, // Industry index (categorical x-axis)
                y: 45.6, // Performance score
                r: 25, // Bubble size based on number of sites
                backgroundColor: '#6366F180'
            }, {
                label: 'Healthcare',
                x: 14, // Industry index (categorical x-axis)
                y: 44.5, // Performance score
                r: 18, // Bubble size based on number of sites
                backgroundColor: '#4F46E580'
            }, {
                label: 'Marketplace',
                x: 15, // Industry index (categorical x-axis)
                y: 44.3, // Performance score
                r: 25, // Bubble size based on number of sites
                backgroundColor: '#3B82F680'
            }, {
                label: 'Finance',
                x: 16, // Industry index (categorical x-axis)
                y: 43.7, // Performance score
                r: 25, // Bubble size based on number of sites
                backgroundColor: '#2563EB80'
            }, {
                label: 'Video',
                x: 17, // Industry index (categorical x-axis)
                y: 43, // Performance score
                r: 5, // Bubble size based on number of sites
                backgroundColor: '#1D4ED880'
            }, {
                label: 'E-commerce',
                x: 18, // Industry index (categorical x-axis)
                y: 42.6, // Performance score
                r: 25, // Bubble size based on number of sites
                backgroundColor: '#1E40AF80'
            }, {
                label: 'Marketing',
                x: 19, // Industry index (categorical x-axis)
                y: 42.3, // Performance score
                r: 18, // Bubble size based on number of sites
                backgroundColor: '#1E3A8A80'
            }, {
                label: 'Energy',
                x: 20, // Industry index (categorical x-axis)
                y: 42, // Performance score
                r: 5, // Bubble size based on number of sites
                backgroundColor: '#312E8180'
            }, {
                label: 'Media',
                x: 21, // Industry index (categorical x-axis)
                y: 41.8, // Performance score
                r: 25, // Bubble size based on number of sites
                backgroundColor: '#10B98180'
            }, {
                label: 'Transportation',
                x: 22, // Industry index (categorical x-axis)
                y: 41.6, // Performance score
                r: 25, // Bubble size based on number of sites
                backgroundColor: '#05966980'
            }, {
                label: 'Realestate',
                x: 23, // Industry index (categorical x-axis)
                y: 41.5, // Performance score
                r: 6, // Bubble size based on number of sites
                backgroundColor: '#04785780'
            }, {
                label: 'Technology',
                x: 24, // Industry index (categorical x-axis)
                y: 40.8, // Performance score
                r: 25, // Bubble size based on number of sites
                backgroundColor: '#065F4680'
            }, {
                label: 'Sports',
                x: 25, // Industry index (categorical x-axis)
                y: 40.8, // Performance score
                r: 24, // Bubble size based on number of sites
                backgroundColor: '#064E3B80'
            }, {
                label: 'Weather',
                x: 26, // Industry index (categorical x-axis)
                y: 40.5, // Performance score
                r: 6, // Bubble size based on number of sites
                backgroundColor: '#F59E0B80'
            }, {
                label: 'Manufacturing',
                x: 27, // Industry index (categorical x-axis)
                y: 40, // Performance score
                r: 5, // Bubble size based on number of sites
                backgroundColor: '#D9770680'
            }, {
                label: 'Non-profit',
                x: 28, // Industry index (categorical x-axis)
                y: 39, // Performance score
                r: 6, // Bubble size based on number of sites
                backgroundColor: '#B4530980'
            }, {
                label: 'Edtech',
                x: 29, // Industry index (categorical x-axis)
                y: 36.5, // Performance score
                r: 6, // Bubble size based on number of sites
                backgroundColor: '#92400E80'
            }, {
                label: 'Software',
                x: 30, // Industry index (categorical x-axis)
                y: 36.3, // Performance score
                r: 9, // Bubble size based on number of sites
                backgroundColor: '#78350F80'
            }, {
                label: 'Food & Drink',
                x: 31, // Industry index (categorical x-axis)
                y: 35, // Performance score
                r: 5, // Bubble size based on number of sites
                backgroundColor: '#EF444480'
            }, {
                label: 'Retail',
                x: 32, // Industry index (categorical x-axis)
                y: 34.3, // Performance score
                r: 21, // Bubble size based on number of sites
                backgroundColor: '#DC262680'
            }, {
                label: 'Telecom',
                x: 33, // Industry index (categorical x-axis)
                y: 34.1, // Performance score
                r: 25, // Bubble size based on number of sites
                backgroundColor: '#B91C1C80'
            }, {
                label: 'Hospitality',
                x: 34, // Industry index (categorical x-axis)
                y: 34, // Performance score
                r: 5, // Bubble size based on number of sites
                backgroundColor: '#991B1B80'
            }, {
                label: 'Automotive',
                x: 35, // Industry index (categorical x-axis)
                y: 33.7, // Performance score
                r: 25, // Bubble size based on number of sites
                backgroundColor: '#7F1D1D80'
            }, {
                label: 'Engineering',
                x: 36, // Industry index (categorical x-axis)
                y: 33, // Performance score
                r: 5, // Bubble size based on number of sites
                backgroundColor: '#6B728080'
            }, {
                label: 'Real Estate',
                x: 37, // Industry index (categorical x-axis)
                y: 31.5, // Performance score
                r: 6, // Bubble size based on number of sites
                backgroundColor: '#22C55E80'
            }, {
                label: 'Travel',
                x: 38, // Industry index (categorical x-axis)
                y: 27, // Performance score
                r: 5, // Bubble size based on number of sites
                backgroundColor: '#16A34A80'
            }];

            new Chart(industryCorrelationCtx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Industries',
                        data: industryData,
                        borderColor: '#22C55E',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Industry Performance Correlation (Bubble size = # of websites)'
                        },
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return context[0].raw.label;
                                },
                                label: function(context) {
                                    const data = context.raw;
                                    const siteCount = Math.round(data.r / 3);
                                    return [
                                        `Performance: ${data.y}`,
                                        `Websites: ${siteCount}`,
                                        `Industry rank: #${data.x}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Industry Rank (by Performance)'
                            },
                            min: 0,
                            max: 39,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    if (value === 0 || value > 38) return '';
                                    const industries = ['Healthtech', 'Gaming', 'Consulting', 'Tech', 'Government', 'Jobs', 'Website editor', 'Search Engine', 'Delivery', 'Portal', 'Social', 'Education', 'Social Media', 'Healthcare', 'Marketplace', 'Finance', 'Video', 'E-commerce', 'Marketing', 'Energy', 'Media', 'Transportation', 'Realestate', 'Technology', 'Sports', 'Weather', 'Manufacturing', 'Non-profit', 'Edtech', 'Software', 'Food & Drink', 'Retail', 'Telecom', 'Hospitality', 'Automotive', 'Engineering', 'Real Estate', 'Travel'];
                                    return industries[value - 1] ? industries[value - 1].substring(0, 8) + '...' : '';
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Average Performance Score'
                            }
                        }
                    }
                }
            });
        }

        // Regional Performance Analysis (Real Data - Interactive Horizontal Bar Chart)
        const regionalAnalysisCtx = document.getElementById('regionalAnalysisChart');
        if (regionalAnalysisCtx) {
            // Store country data for each region for interactive functionality
            const regionCountryData = {
                'Europe': [{"country":"Bulgaria","site_count":3,"avg_performance":58.7,"avg_accessibility":76.7,"avg_best_practices":77.7,"avg_seo":93.7,"avg_pwa":40.7,"best_performance":85,"worst_performance":34},{"country":"Netherlands","site_count":10,"avg_performance":54.4,"avg_accessibility":94.3,"avg_best_practices":82.6,"avg_seo":90.8,"avg_pwa":35.3,"best_performance":90,"worst_performance":16},{"country":"Ukraine","site_count":8,"avg_performance":53.9,"avg_accessibility":80.6,"avg_best_practices":76.3,"avg_seo":92,"avg_pwa":54.1,"best_performance":69,"worst_performance":38},{"country":"Belgium","site_count":8,"avg_performance":53.1,"avg_accessibility":91.8,"avg_best_practices":80.3,"avg_seo":89.5,"avg_pwa":38.8,"best_performance":74,"worst_performance":28},{"country":"Luxembourg","site_count":5,"avg_performance":51,"avg_accessibility":90.2,"avg_best_practices":86.8,"avg_seo":92.8,"avg_pwa":42,"best_performance":90,"worst_performance":21},{"country":"Romania","site_count":5,"avg_performance":50.2,"avg_accessibility":83.4,"avg_best_practices":81.6,"avg_seo":94.8,"avg_pwa":39.8,"best_performance":70,"worst_performance":25},{"country":"Malta","site_count":3,"avg_performance":49.7,"avg_accessibility":86.3,"avg_best_practices":66.7,"avg_seo":89.7,"avg_pwa":29.7,"best_performance":60,"worst_performance":34},{"country":"Lithuania","site_count":5,"avg_performance":49,"avg_accessibility":64.2,"avg_best_practices":73.2,"avg_seo":85,"avg_pwa":46.6,"best_performance":88,"worst_performance":10},{"country":"France","site_count":9,"avg_performance":48.4,"avg_accessibility":86,"avg_best_practices":88,"avg_seo":94.1,"avg_pwa":65.4,"best_performance":72,"worst_performance":32},{"country":"Greece","site_count":5,"avg_performance":48,"avg_accessibility":86.8,"avg_best_practices":80,"avg_seo":93,"avg_pwa":35.2,"best_performance":61,"worst_performance":26},{"country":"Denmark","site_count":8,"avg_performance":47.4,"avg_accessibility":92.1,"avg_best_practices":91.8,"avg_seo":95.3,"avg_pwa":42.9,"best_performance":81,"worst_performance":29},{"country":"Sweden","site_count":42,"avg_performance":47,"avg_accessibility":92.8,"avg_best_practices":89.6,"avg_seo":93,"avg_pwa":42.4,"best_performance":90,"worst_performance":24},{"country":"Turkey","site_count":7,"avg_performance":46.9,"avg_accessibility":88.4,"avg_best_practices":82.1,"avg_seo":91.9,"avg_pwa":42.6,"best_performance":80,"worst_performance":26},{"country":"Poland","site_count":16,"avg_performance":46.1,"avg_accessibility":87.7,"avg_best_practices":81.3,"avg_seo":93.3,"avg_pwa":54.1,"best_performance":79,"worst_performance":23},{"country":"Finland","site_count":44,"avg_performance":45.3,"avg_accessibility":91.2,"avg_best_practices":89.3,"avg_seo":95.7,"avg_pwa":44,"best_performance":100,"worst_performance":11},{"country":"Austria","site_count":10,"avg_performance":45.1,"avg_accessibility":88.9,"avg_best_practices":87.5,"avg_seo":89.3,"avg_pwa":46.6,"best_performance":64,"worst_performance":30},{"country":"Norway","site_count":8,"avg_performance":44.8,"avg_accessibility":93.8,"avg_best_practices":87.5,"avg_seo":95.4,"avg_pwa":37.3,"best_performance":57,"worst_performance":30},{"country":"Germany","site_count":30,"avg_performance":44,"avg_accessibility":88.4,"avg_best_practices":88.6,"avg_seo":91.5,"avg_pwa":49.9,"best_performance":88,"worst_performance":7},{"country":"Spain","site_count":6,"avg_performance":41.2,"avg_accessibility":85.2,"avg_best_practices":76.5,"avg_seo":90.7,"avg_pwa":40.5,"best_performance":54,"worst_performance":28},{"country":"Italy","site_count":7,"avg_performance":40.1,"avg_accessibility":84.9,"avg_best_practices":82,"avg_seo":88.1,"avg_pwa":42.7,"best_performance":58,"worst_performance":31},{"country":"Russia","site_count":9,"avg_performance":39.4,"avg_accessibility":73.3,"avg_best_practices":60.1,"avg_seo":91.1,"avg_pwa":60.6,"best_performance":81,"worst_performance":9},{"country":"United Kingdom","site_count":29,"avg_performance":38.7,"avg_accessibility":88.7,"avg_best_practices":78.4,"avg_seo":89.7,"avg_pwa":44.6,"best_performance":88,"worst_performance":0},{"country":"Switzerland","site_count":8,"avg_performance":38.5,"avg_accessibility":93.1,"avg_best_practices":85.3,"avg_seo":95.1,"avg_pwa":42.9,"best_performance":56,"worst_performance":31},{"country":"Hungary","site_count":8,"avg_performance":37.6,"avg_accessibility":79.3,"avg_best_practices":76.9,"avg_seo":91.5,"avg_pwa":45.6,"best_performance":66,"worst_performance":19},{"country":"Latvia","site_count":6,"avg_performance":36.8,"avg_accessibility":76.8,"avg_best_practices":79.2,"avg_seo":85.2,"avg_pwa":44.3,"best_performance":100,"worst_performance":11},{"country":"Slovakia","site_count":8,"avg_performance":36.5,"avg_accessibility":84.9,"avg_best_practices":77,"avg_seo":92.5,"avg_pwa":45.6,"best_performance":41,"worst_performance":33},{"country":"Estonia","site_count":6,"avg_performance":33.5,"avg_accessibility":88.3,"avg_best_practices":86.2,"avg_seo":93,"avg_pwa":49.8,"best_performance":59,"worst_performance":4},{"country":"Portugal","site_count":1,"avg_performance":12,"avg_accessibility":87,"avg_best_practices":58,"avg_seo":88,"avg_pwa":33,"best_performance":12,"worst_performance":12}],
                'Asia': [{"country":"Malaysia","site_count":3,"avg_performance":79,"avg_accessibility":83.3,"avg_best_practices":92,"avg_seo":85.7,"avg_pwa":33,"best_performance":81,"worst_performance":76},{"country":"Pakistan","site_count":7,"avg_performance":49.4,"avg_accessibility":72.3,"avg_best_practices":73.9,"avg_seo":90.1,"avg_pwa":44.3,"best_performance":89,"worst_performance":25},{"country":"Japan","site_count":7,"avg_performance":44.9,"avg_accessibility":79.4,"avg_best_practices":90.4,"avg_seo":89,"avg_pwa":33,"best_performance":65,"worst_performance":9},{"country":"India","site_count":41,"avg_performance":43.2,"avg_accessibility":84.2,"avg_best_practices":73.6,"avg_seo":86.6,"avg_pwa":45.6,"best_performance":95,"worst_performance":7},{"country":"Hong Kong","site_count":2,"avg_performance":42.5,"avg_accessibility":69.5,"avg_best_practices":83,"avg_seo":84.5,"avg_pwa":33,"best_performance":60,"worst_performance":25},{"country":"Vietnam","site_count":6,"avg_performance":41.7,"avg_accessibility":81.7,"avg_best_practices":73.7,"avg_seo":92.5,"avg_pwa":34.8,"best_performance":59,"worst_performance":27},{"country":"China","site_count":9,"avg_performance":40.3,"avg_accessibility":54.1,"avg_best_practices":64.9,"avg_seo":84.7,"avg_pwa":41.8,"best_performance":56,"worst_performance":18},{"country":"Thailand","site_count":7,"avg_performance":39.1,"avg_accessibility":94.7,"avg_best_practices":76,"avg_seo":96.1,"avg_pwa":52.3,"best_performance":92,"worst_performance":11},{"country":"Philippines","site_count":4,"avg_performance":36.8,"avg_accessibility":78.3,"avg_best_practices":60.3,"avg_seo":75.5,"avg_pwa":35.8,"best_performance":65,"worst_performance":20},{"country":"Bangladesh","site_count":5,"avg_performance":34.8,"avg_accessibility":79.4,"avg_best_practices":75,"avg_seo":92.4,"avg_pwa":57.6,"best_performance":50,"worst_performance":10},{"country":"South Korea","site_count":10,"avg_performance":34.3,"avg_accessibility":77.6,"avg_best_practices":75.1,"avg_seo":89.3,"avg_pwa":33,"best_performance":44,"worst_performance":24},{"country":"Taiwan","site_count":2,"avg_performance":32.5,"avg_accessibility":83.5,"avg_best_practices":83.5,"avg_seo":100,"avg_pwa":33,"best_performance":37,"worst_performance":28},{"country":"Indonesia","site_count":6,"avg_performance":29.8,"avg_accessibility":87.7,"avg_best_practices":79,"avg_seo":92.2,"avg_pwa":36.7,"best_performance":35,"worst_performance":25},{"country":"Singapore","site_count":4,"avg_performance":24,"avg_accessibility":80.5,"avg_best_practices":79,"avg_seo":80.8,"avg_pwa":33,"best_performance":27,"worst_performance":21}],
                'North America': [{"country":"Mexico","site_count":5,"avg_performance":55.2,"avg_accessibility":93.2,"avg_best_practices":88.2,"avg_seo":92.8,"avg_pwa":33,"best_performance":94,"worst_performance":26},{"country":"United States","site_count":80,"avg_performance":43.6,"avg_accessibility":89.5,"avg_best_practices":77.5,"avg_seo":89.1,"avg_pwa":39.6,"best_performance":100,"worst_performance":8},{"country":"Canada","site_count":23,"avg_performance":34.1,"avg_accessibility":93.2,"avg_best_practices":69.5,"avg_seo":87.4,"avg_pwa":42.3,"best_performance":74,"worst_performance":5}],
                'South America': [{"country":"Bolivia","site_count":3,"avg_performance":78.7,"avg_accessibility":83.7,"avg_best_practices":100,"avg_seo":94.7,"avg_pwa":33,"best_performance":98,"worst_performance":67},{"country":"Brazil","site_count":10,"avg_performance":48.2,"avg_accessibility":85.4,"avg_best_practices":79.1,"avg_seo":89.3,"avg_pwa":47.6,"best_performance":81,"worst_performance":2},{"country":"Uruguay","site_count":3,"avg_performance":45.7,"avg_accessibility":72.3,"avg_best_practices":77.7,"avg_seo":92.7,"avg_pwa":36.7,"best_performance":60,"worst_performance":35},{"country":"Chile","site_count":7,"avg_performance":36,"avg_accessibility":81.3,"avg_best_practices":76.1,"avg_seo":88.1,"avg_pwa":31.4,"best_performance":58,"worst_performance":6},{"country":"Paraguay","site_count":3,"avg_performance":35.7,"avg_accessibility":92.3,"avg_best_practices":80.3,"avg_seo":95,"avg_pwa":55.7,"best_performance":50,"worst_performance":22},{"country":"Argentina","site_count":3,"avg_performance":29.7,"avg_accessibility":93.7,"avg_best_practices":75,"avg_seo":89.7,"avg_pwa":36.7,"best_performance":41,"worst_performance":11}],
                'Africa': [{"country":"Zambia","site_count":9,"avg_performance":51.8,"avg_accessibility":90.1,"avg_best_practices":80.6,"avg_seo":85.2,"avg_pwa":30.7,"best_performance":100,"worst_performance":21},{"country":"Namibia","site_count":6,"avg_performance":43.7,"avg_accessibility":83.2,"avg_best_practices":83.2,"avg_seo":85.3,"avg_pwa":33,"best_performance":61,"worst_performance":25},{"country":"Morocco","site_count":4,"avg_performance":41.8,"avg_accessibility":79.3,"avg_best_practices":73,"avg_seo":88.3,"avg_pwa":41.5,"best_performance":84,"worst_performance":0},{"country":"Kenya","site_count":5,"avg_performance":39.2,"avg_accessibility":91.6,"avg_best_practices":71.8,"avg_seo":89.8,"avg_pwa":30.8,"best_performance":50,"worst_performance":27},{"country":"Egypt","site_count":8,"avg_performance":36.5,"avg_accessibility":87.3,"avg_best_practices":66.6,"avg_seo":91.3,"avg_pwa":45.8,"best_performance":56,"worst_performance":19},{"country":"South Africa","site_count":7,"avg_performance":36.1,"avg_accessibility":88.6,"avg_best_practices":78.6,"avg_seo":85.9,"avg_pwa":53.9,"best_performance":87,"worst_performance":10}],
                'Middle East': [{"country":"Iran","site_count":8,"avg_performance":63.9,"avg_accessibility":81,"avg_best_practices":70.9,"avg_seo":88,"avg_pwa":35.9,"best_performance":99,"worst_performance":29},{"country":"Libya","site_count":5,"avg_performance":54.4,"avg_accessibility":89.4,"avg_best_practices":81.6,"avg_seo":86,"avg_pwa":33,"best_performance":82,"worst_performance":35},{"country":"Saudi Arabia","site_count":3,"avg_performance":39,"avg_accessibility":72.7,"avg_best_practices":77.7,"avg_seo":87.7,"avg_pwa":33,"best_performance":48,"worst_performance":29},{"country":"Israel","site_count":10,"avg_performance":34,"avg_accessibility":73.1,"avg_best_practices":74.9,"avg_seo":89.7,"avg_pwa":35.2,"best_performance":42,"worst_performance":23},{"country":"United Arab Emirates","site_count":3,"avg_performance":28.3,"avg_accessibility":90.7,"avg_best_practices":69.3,"avg_seo":83.3,"avg_pwa":40.7,"best_performance":30,"worst_performance":27}],
                'Oceania': [{"country":"Australia","site_count":8,"avg_performance":46.6,"avg_accessibility":66.9,"avg_best_practices":86.4,"avg_seo":93,"avg_pwa":47.1,"best_performance":65,"worst_performance":30},{"country":"New Zealand","site_count":5,"avg_performance":40,"avg_accessibility":83.2,"avg_best_practices":65,"avg_seo":88.2,"avg_pwa":46.6,"best_performance":71,"worst_performance":27}]
            };

            // Calculate regional averages
            const regionalAverages = Object.entries(regionCountryData).map(([region, countries]) => ({
                region,
                average: countries.length > 0 ? countries.reduce((sum, c) => sum + c.avg_performance, 0) / countries.length : 0,
                count: countries.length
            })).filter(r => r.count > 0);

            // Sort by performance (highest first) and calculate differences from median
            const sortedRegions = regionalAverages.sort((a, b) => b.average - a.average);
            const medianIndex = Math.floor(sortedRegions.length / 2);
            const medianScore = sortedRegions[medianIndex].average;
            
            let currentView = 'regional'; // Track current view: 'regional' or region name
            let regionalChart = null;

            function createRegionalChart() {
                const regionLabels = sortedRegions.map(r => r.region);
                const differences = sortedRegions.map(r => r.average - medianScore);

                const config = {
                    type: 'bar',
                    data: {
                        labels: regionLabels,
                        datasets: [{
                            label: 'Performance Difference',
                            data: differences,
                            backgroundColor: differences.map(diff => diff > 0 ? '#10B981' : diff < 0 ? '#EF4444' : '#6B7280'),
                            borderColor: differences.map(diff => diff > 0 ? '#059669' : diff < 0 ? '#DC2626' : '#4B5563'),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Regional Performance vs Median (Click to explore countries)'
                            },
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const diff = context.parsed.x;
                                        const actualScore = medianScore + diff;
                                        if (diff === 0) {
                                            return context.label + ': ' + actualScore.toFixed(1) + ' (median)';
                                        } else {
                                            const sign = diff > 0 ? '+' : '';
                                            return context.label + ': ' + actualScore.toFixed(1) + ' (' + sign + diff.toFixed(1) + ' vs median)';
                                        }
                                    },
                                    afterLabel: function() {
                                        return 'Click to see countries in this region';
                                    }
                                }
                            }
                        },
                        onClick: function(event, elements) {
                            if (elements.length > 0) {
                                const elementIndex = elements[0].index;
                                const regionName = regionLabels[elementIndex];
                                showCountriesInRegion(regionName);
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Performance Difference from Median Region'
                                },
                                grid: {
                                    color: function(context) {
                                        return context.tick.value === 0 ? '#374151' : '#E5E7EB';
                                    }
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Region'
                                }
                            }
                        }
                    }
                };

                if (regionalChart) {
                    regionalChart.destroy();
                }
                regionalChart = new Chart(regionalAnalysisCtx, config);
                currentView = 'regional';
            }

            function showCountriesInRegion(regionName) {
                const countries = regionCountryData[regionName];
                if (!countries || countries.length === 0) return;

                // Sort countries by performance and calculate differences from region median
                const sortedCountries = countries.sort((a, b) => b.avg_performance - a.avg_performance);
                const regionMedianIndex = Math.floor(sortedCountries.length / 2);
                const regionMedianScore = sortedCountries[regionMedianIndex].avg_performance;

                const countryLabels = sortedCountries.map(c => c.country);
                const countryDifferences = sortedCountries.map(c => c.avg_performance - regionMedianScore);

                const config = {
                    type: 'bar',
                    data: {
                        labels: countryLabels,
                        datasets: [{
                            label: 'Performance Difference',
                            data: countryDifferences,
                            backgroundColor: countryDifferences.map(diff => diff > 0 ? '#10B981' : diff < 0 ? '#EF4444' : '#6B7280'),
                            borderColor: countryDifferences.map(diff => diff > 0 ? '#059669' : diff < 0 ? '#DC2626' : '#4B5563'),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: regionName + ' Countries vs Regional Median'
                            },
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const diff = context.parsed.x;
                                        const actualScore = regionMedianScore + diff;
                                        if (diff === 0) {
                                            return context.label + ': ' + actualScore.toFixed(1) + ' (regional median)';
                                        } else {
                                            const sign = diff > 0 ? '+' : '';
                                            return context.label + ': ' + actualScore.toFixed(1) + ' (' + sign + diff.toFixed(1) + ' vs regional median)';
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Performance Difference from Regional Median'
                                },
                                grid: {
                                    color: function(context) {
                                        return context.tick.value === 0 ? '#374151' : '#E5E7EB';
                                    }
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Country'
                                }
                            }
                        }
                    }
                };

                if (regionalChart) {
                    regionalChart.destroy();
                }
                regionalChart = new Chart(regionalAnalysisCtx, config);
                currentView = regionName;

                // Add back button
                addBackButton();
            }

            function addBackButton() {
                // Remove existing back button if any
                const existingBtn = document.getElementById('regionalBackBtn');
                if (existingBtn) {
                    existingBtn.remove();
                }

                // Create back button
                const backBtn = document.createElement('button');
                backBtn.id = 'regionalBackBtn';
                backBtn.innerHTML = '‚Üê Back to Regional View';
                backBtn.style.cssText = 'margin-top: 10px; padding: 8px 16px; background: #3B82F6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;';
                backBtn.onclick = function() {
                    createRegionalChart();
                    backBtn.remove();
                };

                // Insert after the chart container
                const chartSection = regionalAnalysisCtx.closest('.chart-section');
                if (chartSection) {
                    chartSection.appendChild(backBtn);
                }
            }

            // Initialize with regional view
            createRegionalChart();
        }
    </script>
    <!-- PostHog Analytics -->
    <script>
        !function(t,e){var o,n,p,r;e.__SV||(window.posthog && window.posthog.__loaded)||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init yi Ar jr mi Or Mr capture Li calculateEventProperties Nr register register_once register_for_session unregister unregister_for_session Br getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey displaySurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty zr Lr createPersonProfile Hr Rr qr opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing get_explicit_consent_status is_capturing clear_opt_in_out_capturing Dr debug L Ur getPageViewId captureTraceFeedback captureTraceMetric Pr".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
        posthog.init('phc_txSL3d2o8C7Y5fzys73cLBx88FYqcThmBOQ4XiIObgh', {
            api_host: 'https://us.i.posthog.com',
            defaults: '2025-05-24',
            person_profiles: 'identified_only'
        });
    </script>
</body>
</html>